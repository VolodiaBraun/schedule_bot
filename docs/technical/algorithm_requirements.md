# Алгоритм работы системы записи без "окон"

## Основная концепция

Система записи без "окон" предотвращает ситуацию, при которой между двумя занятыми слотами остается небольшой промежуток времени, который не может быть использован для новой записи. Вместо этого система учитывает максимальное количество сеансов в день и динамически рассчитывает доступные комбинации слотов, чтобы избежать формирования "окон".

## Пример работы алгоритма

Допустим, установлено расписание: среда с 16:00 до 20:00, сеанс 1 час, максимум 3 сеанса в день.

### Сценарий 1: Начальное состояние
- Расписание: 16:00, 17:00, 18:00, 19:00 - всего 4 возможных слота
- Максимальное количество сеансов: 3
- Доступные комбинации: любые 3 слота из 4, при условии, что они не создают "окна"

Возможные комбинации:
1. 16:00, 17:00, 18:00 (окно после - 19:00)
2. 16:00, 17:00, 19:00 (окно между - 18:00)
3. 16:00, 18:00, 19:00 (окно между - 17:00)
4. 17:00, 18:00, 19:00 (окно до - 16:00)

Система выбирает комбинации, которые не создают "окна" между занятыми слотами:
- Комбинация 1: 16:00, 17:00, 18:00 (19:00 остается свободным)
- Комбинация 4: 17:00, 18:00, 19:00 (16:00 остается свободным)

Таким образом, при первоначальном выборе клиент может выбрать:
- Комбинацию 16:00, 17:00, 18:00
- Или комбинацию 17:00, 18:00, 19:00

При этом система будет отображать все 4 слота, но при выборе одного из них, автоматически заблокирует комбинации, которые создают "окна".

### Сценарий 2: После первой записи
Если клиент выбирает 17:00, система должна рассчитать новые доступные слоты с учетом уже занятого:

- Занят: 17:00
- Остальные слоты: 16:00, 18:00, 19:00
- Максимально доступно: 2 (осталось 2 из 3)

Система проверяет возможные комбинации:
1. 16:00 и 18:00 (окно - 19:00)
2. 16:00 и 19:00 (окно - 18:00)
3. 18:00 и 19:00 (окно - 16:00)

Поскольку все возможные комбинации из 2 слотов создают "окно", система может:
1. Позволить выбрать только один из оставшихся слотов (16:00, 18:00 или 19:00)
2. Допустить выбор второго слота, но с учетом правила "без окон" на следующем уровне

## Алгоритм реализации

### Шаг 1: Генерация всех возможных комбинаций
Для каждого дня с установленным расписанием генерируются все возможные комбинации сеансов в пределах максимального количества.

### Шаг 2: Фильтрация комбинаций
Из сгенерированных комбинаций удаляются те, которые создают "окна":
- Определяется минимальная и максимальная занятые ячейки
- Проверяется, есть ли незанятые ячейки между ними
- Комбинации с "окнами" исключаются

### Шаг 3: Учет уже забронированных слотов
При наличии уже забронированных слотов:
- Учитываются только комбинации, которые не включают занятые слоты
- Рассчитываются новые возможные комбинации с учетом уже занятых слотов

### Шаг 4: Отображение доступных слотов
Отображаются только те слоты, которые могут быть заняты в рамках допустимых комбинаций.

## Особые условия

1. Если количество доступных слотов равно максимальному количеству сеансов в день, все слоты становятся недоступны.
2. Если количество занятых слотов достигает максимального, все слоты в этот день становятся недоступны.
3. Система может предложить пользователю выбрать из нескольких возможных комбинаций, если существует несколько допустимых вариантов.