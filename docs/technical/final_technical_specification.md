# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
# на разработку Telegram-бота для записи клиентов к психологу без формирования "окон" в расписании

## 1. ВВЕДЕНИЕ

### 1.1 Наименование проекта
Telegram-бот для записи клиентов к психологу без формирования "окон" в расписании.

### 1.2 Цель и задачи проекта
**Цель проекта:** Разработка Telegram-бота, обеспечивающего удобное и гибкое бронирование времени сеансов к психологу с учетом специфических требований: избегания "окон" (незанятых периодов между сеансами) в расписании и ограничения максимального количества сеансов в день.

**Задачи проекта:**
1. Обеспечить возможность администратору (психологу) устанавливать графики работы с указанием дней, времени начала и окончания, а также максимального количества сеансов в день.
2. Реализовать систему бронирования для клиентов с отображением только доступного времени без "окон" между сеансами.
3. Разработать интеллектуальный алгоритм выбора доступного времени, предотвращающий возникновение "окон" в расписании.
4. Обеспечить удобный интерфейс взаимодействия через Telegram с использованием кнопок и календаря.
5. Обеспечить надежное хранение и учет всех записей с возможностью административного управления.

## 2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 2.1 Административная панель
#### 2.1.1 Управление расписанием
- Администратор должен иметь возможность устанавливать график работы для каждого дня недели
- Возможность указать диапазон времени работы (например, с 16:00 до 20:00)
- Возможность установить максимальное количество сеансов в день (например, 3 сеанса)
- Возможность указать длительность одного сеанса (по умолчанию 1 час)
- Возможность исключения определенных дат из расписания

#### 2.1.2 Управление записями
- Просмотр всех текущих записей
- Возможность отменить/удалить запись
- Возможность перенести запись на другое время
- Просмотр истории записей

#### 2.1.3 Настройки
- Возможность изменить длительность сеанса
- Настройка уведомлений
- Возможность включить/отключить онлайн-запись

### 2.2 Система бронирования для клиентов
#### 2.2.1 Выбор даты
- Отображение календаря для выбора даты визита
- Отображение только доступных дат (когда установлено расписание и есть доступные слоты)
- Возможность просмотра нескольких месяцев вперед

#### 2.2.2 Выбор времени
- Отображение доступного времени для выбранной даты
- Исключение времени, которое создает "окна" между сеансами
- Отображение только возможных комбинаций с учетом максимального количества сеансов в день
- Подсветка занятых слотов

#### 2.2.3 Бронирование
- Возможность забронировать выбранный слот
- Подтверждение бронирования
- Возможность отменить собственную запись до определенного времени

### 2.3 Интерфейс взаимодействия
#### 2.3.1 Администратор
- Команды для входа в административный режим
- Меню управления расписанием
- Интерфейс просмотра и редактирования записей

#### 2.3.2 Клиент
- Приветственное сообщение с инструкциями
- Пошаговое руководство по бронированию
- Подтверждение действий

## 3. НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### 3.1 Производительность
- Время отклика системы на команды пользователя не должно превышать 2 секунд
- Алгоритм проверки доступности слотов должен выполняться за время не более 1 секунды
- Система должна корректно обрабатывать одновременные запросы от нескольких пользователей

### 3.2 Надежность
- Время доступности системы должно составлять не менее 95% в течение календарного месяца
- Обеспечение целостности данных при одновременном доступе к расписанию
- Операции бронирования должны быть атомарными

### 3.3 Безопасность
- Только авторизованные администраторы должны иметь доступ к административным функциям
- Обработка и хранение персональных данных клиентов в соответствии с требованиями конфиденциальности
- Защита от подбора административных команд

## 4. АРХИТЕКТУРА СИСТЕМЫ

### 4.1 Структура базы данных
Система должна использовать реляционную базу данных (предпочтительно PostgreSQL или SQLite) для хранения информации о расписании, записях, пользователях и настройках.

#### 4.1.1 Основные таблицы:
- administrators - информация об администраторах
- schedules - расписание работы по дням недели
- specific_dates - исключения для конкретных дат
- bookings - записи клиентов
- users - информация о пользователях
- settings - настройки системы

### 4.2 Алгоритмы работы системы
#### 4.2.1 Алгоритм "без окон"
Система записи без "окон" предотвращает ситуацию, при которой между двумя занятыми слотами остается небольшой промежуток времени, который не может быть использован для новой записи. Система учитывает максимальное количество сеансов в день и динамически рассчитывает доступные слоты, чтобы избежать формирования "окон" независимо от порядка выбора слотов клиентами.

**Основное правило:** Слот отображается как доступный, только если его выбор не может привести к формированию комбинации с окном в пределах лимита сеансов в день.

Алгоритм:
1. Определение текущего состояния (занятые слоты в выбранный день, оставшееся количество сеансов до лимита)
2. Для каждого свободного слота генерация всех возможных комбинаций с учетом уже занятых слотов и оставшегося лимита
3. Проверка каждой комбинации на наличие "окон" между занятыми слотами:
   - Упорядочивание слотов по времени
   - Проверка, есть ли пропущенные слоты между первым и последним занятыми слотами
   - Если есть пропущенные слоты, комбинация считается недопустимой
4. Включение в список доступных только тех слотов, которые могут быть частью хотя бы одной допустимой комбинации (без окон)
5. Исключение слотов, выбор которых может привести к формированию комбинации с окном

### 4.3 Взаимодействие с Telegram API
- Использование официального Telegram Bot API
- Обработка входящих сообщений и команд
- Отображение интерактивных клавиатур с кнопками

## 5. ИНТЕРФЕЙС ПОЛЬЗОВАТЕЛЯ

### 5.1 Интерфейс администратора
#### 5.1.1 Команды
- /admin - активация административного режима
- /schedule - управление расписанием
- /bookings - просмотр всех записей
- /settings - настройки бота

#### 5.1.2 Управление расписанием
- Интерактивное меню для выбора дня недели
- Кнопки для установки времени начала и окончания работы
- Поле ввода для указания максимального количества сеансов в день
- Календарь для установки расписания на конкретные даты

#### 5.1.3 Просмотр записей
- Таблица/список текущих записей с сортировкой по дате
- Возможность фильтрации по дате/времени
- Кнопки для редактирования/удаления записей

### 5.2 Интерфейс клиента
#### 5.2.1 Начальное взаимодействие
- Приветственное сообщение с кратким описанием функций бота
- Кнопки основных действий: "Записаться", "Мои записи", "Отменить запись"

#### 5.2.2 Выбор даты
- Календарь в виде кнопок (предпочтительно в формате календаря)
- Возможность переключения между месяцами
- Подсветка доступных дат
- Отображение количества доступных слотов для каждой даты

#### 5.2.3 Выбор времени
- Графическое отображение доступного времени в виде кнопок
- Отображение только допустимых временных слотов с учетом алгоритма "без окон"
- Подсветка забронированных слотов
- Подтверждение выбора времени

#### 5.2.4 Подтверждение записи
- Визуализация выбранного времени и даты
- Запрос подтверждения
- Сообщение об успешной записи
- Возможность отмены до определенного времени

### 5.3 Общие требования к интерфейсу
#### 5.3.1 Визуальные элементы
- Все временные слоты должны быть представлены в виде интерактивных кнопок
- Использование эмодзи для улучшения восприятия (календарь, часы, галочка и т.д.)
- Четкое разделение состояний: доступное, занятое, выбранное время

#### 5.3.2 Пользовательский опыт
- Минимальное количество шагов для записи
- Понятные подсказки на каждом этапе
- Автоматический переход между этапами
- Обратная связь при каждой операции

## 6. ТРЕБОВАНИЯ К РЕАЛИЗАЦИИ

### 6.1 Технологии разработки
- Язык программирования: Python
- Фреймворк для работы с Telegram Bot API: aiogram или python-telegram-bot
- База данных: PostgreSQL или SQLite
- Для интерфейса календаря можно использовать библиотеку aiogram-calendar или аналогичную

### 6.2 Среда выполнения
- Приложение должно быть кроссплатформенным
- Поддержка развертывания на сервере (VPS, облачные платформы)
- Возможность запуска как сервиса (systemd service или аналог)

### 6.3 Требования к хостингу
- Поддержка Python 3.8+
- Доступ к базе данных
- Постоянное подключение к интернету для взаимодействия с Telegram API
- Поддержка webhook или возможность поддержания постоянного соединения

## ПРИЛОЖЕНИЯ

### Приложение А - Структура базы данных
(Подробное описание структуры таблиц содержится в разделе 4.1)

### Приложение Б - Алгоритм работы системы "без окон"
(Подробное описание алгоритма содержится в разделе 4.2)